(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5c6d3deb","chunk-c8882352"],{"06c5":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));a("a630"),a("fb6a"),a("b0c0"),a("d3b7"),a("ac1f"),a("25f0"),a("3ca3");var r=a("6b75");function o(e,t){if(e){if("string"===typeof e)return Object(r["a"])(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Object(r["a"])(e,t):void 0}}},2909:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var r=a("6b75");function o(e){if(Array.isArray(e))return Object(r["a"])(e)}a("a4d3"),a("e01a"),a("d28b"),a("a630"),a("d3b7"),a("3ca3"),a("ddb0");function n(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var i=a("06c5");function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e){return o(e)||n(e)||Object(i["a"])(e)||c()}},"448a":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:!1}},[t("a-form",{staticStyle:{"margin-bottom":"16px"},attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:12,type:"flex",align:"middle",justify:"end"}},[t("a-col",{attrs:{md:14,sm:24}},[t("a-form-item",{attrs:{label:"申报WTR天数"}},[t("span",{staticStyle:{color:"#409EFF"}},[e._v(e._s(e.getWtrCount))])])],1),t("a-col",{attrs:{md:8,sm:24,offset:2}},[t("div",{staticStyle:{float:"right"}},[t("a-form-item",{attrs:{label:"日报时间"}},[t("a-month-picker",{staticStyle:{width:"120px"},attrs:{format:e.dateFormat},on:{change:e.onChange},model:{value:e.dailyTime,callback:function(t){e.dailyTime=t},expression:"dailyTime"}})],1),t("a-button",{staticStyle:{"margin-left":"8px","margin-top":"4px",float:"right"},attrs:{type:"primary"},on:{click:function(t){return e.init()}}},[e._v("查询")])],1)])],1)],1),t("a-table",{attrs:{bordered:"",dataSource:e.dataSource,columns:e.columns,pagination:!1,size:"middle",rowClassName:e.rowClassName,scroll:{x:!0}},scopedSlots:e._u([{key:"job_description",fn:function(a,r){return[r.editable?[t("editable-cell",{ref:"job_description_".concat(r.key),attrs:{formType:"textarea",defaultEditable:r.editable,autoSave:!0,placeholder:"请输入",value:a,text:a},on:{"on-blur":function(t){return e.onBlur(r.key,"job_description",t)}}})]:[t("a-popover",{attrs:{content:a}},[t("span",{style:e.fittedClass},[e._v(e._s(a))])])]]}},{key:"task_source",fn:function(a,r){return[t("editable-cell",{ref:"task_source_".concat(r.key),attrs:{formType:"select",defaultEditable:r.editable,autoSave:!1,message:"请选择",value:r.task_source,text:r.task_source,allowClearSelect:!0},on:{selectChange:function(t){return e.onCellChange(r.key,"task_source",t)}}},[t("a-select-option",{attrs:{value:"product"}},[e._v("product")]),t("a-select-option",{attrs:{value:"central deployment"}},[e._v("central deployment")]),t("a-select-option",{attrs:{value:"local pm"}},[e._v("local pm")])],1)]}},{key:"job_category",fn:function(a,r){return[t("editable-cell",{ref:"job_category_".concat(r.key),attrs:{formType:"select",defaultEditable:r.editable,autoSave:!1,message:"请选择",value:r.job_category,text:r.job_category,decoratorOptions:e.rules.job_category,allowClearSelect:!0},on:{selectChange:function(t){return e.onCellChange(r.key,"job_category",t)}}},[t("a-select-option",{attrs:{value:"BigData/AI/GIS"}},[e._v("BigData/AI/GIS")]),t("a-select-option",{attrs:{value:"Project Coordination"}},[e._v("Project Coordination")]),t("a-select-option",{attrs:{value:"Project Management"}},[e._v("Project Management")]),t("a-select-option",{attrs:{value:"Requirement Analytic"}},[e._v("Requirement Analytic")]),t("a-select-option",{attrs:{value:"Software Development"}},[e._v("Software Development")]),t("a-select-option",{attrs:{value:"SW&HW Maintenance&Testing"}},[e._v("SW&HW Maintenance&Testing")])],1)]}},{key:"category",fn:function(a,r){return[t("editable-cell",{ref:"category_".concat(r.key),attrs:{formType:"select",defaultEditable:r.editable,autoSave:!1,message:"请选择",value:r.category,text:r.category,decoratorOptions:e.rules.category},on:{selectChange:function(t){return e.onCellChange(r.key,"category",t)}}},[t("a-select-option",{attrs:{value:"工作日"}},[e._v("工作日")]),t("a-select-option",{attrs:{value:"休息日"}},[e._v("休息日")]),t("a-select-option",{attrs:{value:"学习日"}},[e._v("学习日")])],1)]}},{key:"working_place",fn:function(a,r){return[t("editable-cell",{ref:"working_place_".concat(r.key),attrs:{text:a,defaultEditable:r.editable,autoSave:!1,value:a,decoratorOptions:e.rules.working_place},on:{valueChange:function(t){return e.onCellChange(r.key,"working_place",t)}}})]}},{key:"operation",fn:function(a,r){return[t("div",{staticClass:"editable-row-operations"},[r.editable?t("span",[t("a",{on:{click:function(){return e.save(r)}}},[e._v("保存")]),t("a-divider",{attrs:{type:"vertical"}}),t("a-popconfirm",{attrs:{title:"确定取消?"},on:{confirm:function(){return e.cancel(r.key)}}},[t("a",[e._v("取消")])])],1):t("span",[t("a",{attrs:{disabled:""!==e.editingKey||e.getTimeFlag(r.daily_time)},on:{click:function(){return e.edit(r.key)}}},[t("a-icon",{attrs:{type:"edit"}})],1)])])]}}])})],1)},o=[],n=a("5530"),i=a("2909"),c=(a("99af"),a("4de4"),a("7db0"),a("a9e3"),a("d3b7"),a("159b"),a("de08")),l=a("46ad"),s=a("c32d"),d=a.n(s),u=[{title:"日期",dataIndex:"daily_time",width:110},{title:"星期",dataIndex:"week",width:70},{title:"工作简要描述",dataIndex:"job_description",scopedSlots:{customRender:"job_description"},width:210},{title:"工作类别",dataIndex:"job_category",width:240,scopedSlots:{customRender:"job_category"}},{title:"任务来源",dataIndex:"task_source",scopedSlots:{customRender:"task_source"},width:160},{title:"日期类别",dataIndex:"category",width:110,scopedSlots:{customRender:"category"}},{title:"地点",dataIndex:"working_place",width:100,scopedSlots:{customRender:"working_place"}},{title:"操作",dataIndex:"operation",width:120,scopedSlots:{customRender:"operation"}}],f={name:"DailyReport",components:{EditableCell:c["default"]},data:function(){return{signData:[],mulData:[],dateFormat:"YYYY-MM",dataSource:[],count:0,columns:u,fields:["job_category","category","task_source","working_place"],userId:0,dailyTime:d()(),rules:{job_category:{},category:{},working_place:{}},clientWidth:1200,editingKey:"",hasRemind:!1}},created:function(){this.userId=this.$store.state.user.info.user_id,this.init()},mounted:function(){var e=this;this.clientWidth=document.body.clientWidth,window.onresize=function(){return function(){e.$nextTick((function(){e.clientWidth=document.body.clientWidth}))}()}},computed:{getWtrCount:function(){return this.dataSource.filter((function(e){return""!==e.job_description})).length},fittedClass:function(){var e=this.clientWidth>1650?650:this.clientWidth>1500?480:this.clientWidth>1400?410:210;return this.columns.forEach((function(t){"job_description"===t.dataIndex&&(t.width=e+20)})),{overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap",display:"inline-block",width:e+"px"}}},methods:{moment:d.a,getTimeFlag:function(e){return d()(e).isAfter(d()(),"day")},onChange:function(e,t){},init:function(e){var t=this;this.dataSource=[],e&&(this.dailyTime=e);var a=d()(this.dailyTime).format("L").split("/")[1],r=d()(this.dailyTime).year();Object(l["i"])({user_id:this.userId,monthly_report_time:"P".concat(a,".Y").concat(r)}).then((function(e){var o=new Date(r,a,0).getDate(),n={},i=Number(a)-1;d()([r,a,5]).diff(d()(),"days")<0||d()([r,a,5]).diff(d()(),"days")+1>=d()().daysInMonth()?t.columns=u.filter((function(e){return"operation"!==e.dataIndex})):t.columns=u;for(var c=0;c<o;c++){var l=c+1,s=d()(new Date(r,i,l)).format("dddd");n={key:l,daily_time:d()(new Date(r,i,l)).format("YYYY-MM-DD"),week:s,job_description:"",task_source:"",job_category:"",category:t.getDayType(s),working_place:""},e.list.forEach((function(e){n.daily_time===d()(e.daily_time).format("YYYY-MM-DD")&&(n.job_description=e.job_description,n.category=e.category,n.job_category=e.job_category,n.working_place=e.working_place,n.task_source=e.task_source,n.id=e.id)})),t.dataSource.push(n)}}))},rowClassName:function(e,t){return["星期六","星期日"].indexOf(e.week)>-1?"weekDayClass":""},getDayType:function(e){return["星期六","星期日"].indexOf(e)<0?"工作日":"休息日"},onCellChange:function(e,t,a){var r=Object(i["a"])(this.dataSource),o=r.find((function(t){return t.key===e}));o&&(o[t]=a,this.dataSource=r)},onBlur:function(e,t,a){var r=this;"job_description"===t&&(this.getRulesByValue(a),this.validateRow(e,this.fields,(function(t,a){t||r.fields.forEach((function(t){var o="".concat(t,"_").concat(e);r.$refs[o].setValue(a[t]),r.$forceUpdate()}))})))},edit:function(e){var t=Object(i["a"])(this.dataSource),a=t.filter((function(t){return e===t.key}))[0];this.editingKey=e,a&&(a.editable=!0,this.dataSource=t)},getRulesByValue:function(e){this.rules=""!==e?{job_category:{rules:[{required:!0,message:"请选择"}]},category:{rules:[{required:!0,message:"请选择"}]},working_place:{rules:[{required:!0,message:"请输入"}]}}:{job_category:{},category:{},working_place:{}}},save:function(e){var t=this;if(!0!==this.hasRemind){!1===this.hasRemind&&(this.hasRemind=!0,setTimeout((function(){t.hasRemind=!1}),3e3));var a=e.key,r=this.$refs["job_description_".concat(a)].validate(),o=r.value;this.getRulesByValue(o),setTimeout((function(){t.validateRow(a,t.fields,(function(e,r){if(!e){var c=Object(i["a"])(t.dataSource),s=c.find((function(e){return a===e.key}));if(Object.assign(s,r),s.user_id||(s.user_id=t.userId),!s.monthly_report_time){var u=d()(s.daily_time).format("L").split("/")[1],f=d()(s.daily_time).year();s.monthly_report_time="P".concat(u,".Y").concat(f)}try{s.ip_address=returnCitySN["cip"]}catch(p){s.ip_address="0.0.0.0"}delete s.editable,t.editingKey="";var m=Object(n["a"])({},s);delete m.key,"undefined"===typeof m.job_category&&(m.job_category=""),"undefined"===typeof m.task_source&&(m.task_source=""),m.job_description=o,s.id?Object(l["k"])(m).then((function(e){"ok"===e.state&&(t.$message.success("更新成功",2),t.init())})):Object(l["a"])(m).then((function(e){"ok"===e.state&&(t.$message.success("添加成功",2),t.init())}))}}))}),500)}},cancel:function(e){var t=Object(i["a"])(this.dataSource),a=t.filter((function(t){return e===t.key}))[0];this.editingKey="",a&&(delete a.editable,this.dataSource=t)},validateRow:function(e,t,a){var r=this,o={},n=!1;t.forEach((function(t){var a="".concat(t,"_").concat(e),i=r.$refs[a].validate();o[t]=i.value,i.success||(n=!0)})),a(n,o)}}},m=f,p=(a("a5cd"),a("a7cb"),a("2877")),h=Object(p["a"])(m,r,o,!1,null,"3176bcf4",null);t["default"]=h.exports},"46ad":function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"f",(function(){return i})),a.d(t,"e",(function(){return c})),a.d(t,"c",(function(){return l})),a.d(t,"g",(function(){return s})),a.d(t,"l",(function(){return d})),a.d(t,"a",(function(){return u})),a.d(t,"h",(function(){return f})),a.d(t,"d",(function(){return m})),a.d(t,"k",(function(){return p})),a.d(t,"i",(function(){return h})),a.d(t,"j",(function(){return y}));var r=a("b775"),o={add:"mr/add_report",query:"mr/query",update:"mr/update_report",statistic:"mr/report_statistical",overview:"mr/detail_report",details:"mr/report_detail_query",updateInfo:"mr/update_info",getRole:"mr/role",getPersonnelInfo:"mr/approval_personnel_query",getDailyByPerson:"mr/approval_mr_query",approveDaily:"mr/approval_mr_update",approveBatch:"mr/approval_mr_update_batch"};function n(e){return Object(r["b"])({url:o.approveBatch,method:"post",params:e})}function i(e){return Object(r["b"])({url:o.getPersonnelInfo,method:"post",params:e})}function c(e){return Object(r["b"])({url:o.getDailyByPerson,method:"post",params:e})}function l(e){return Object(r["b"])({url:o.approveDaily,method:"post",params:e})}function s(e){return Object(r["b"])({url:o.getRole,method:"post",params:e})}function d(e){return Object(r["b"])({url:o.updateInfo,method:"post",params:e})}function u(e){return Object(r["b"])({url:o.add,method:"post",params:e})}function f(e){return Object(r["b"])({url:o.overview,method:"post",params:e})}function m(e){return Object(r["b"])({url:o.details,method:"post",params:e})}function p(e){return Object(r["b"])({url:o.update,method:"post",params:e})}function h(e){return Object(r["b"])({url:o.query,method:"post",params:e})}function y(e){return Object(r["b"])({url:o.statistic,method:"post",params:e})}},"5bb3":function(e,t,a){},"61b2":function(e,t,a){},"6b75":function(e,t,a){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}a.d(t,"a",(function(){return r}))},a5cd:function(e,t,a){"use strict";a("61b2")},a7cb:function(e,t,a){"use strict";a("5bb3")},be0e:function(e,t,a){},de08:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"editable-cell"},[e.editable?t("div",{class:["editable-cell-input-wrapper",e.singleEdit?"single-edit":""]},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{staticClass:"no-validate",attrs:{colon:!1}},[e.showFormItem("input")?t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorator,expression:"decorator"}],attrs:{placeholder:e.placeholder,autocomplete:"off"},on:{change:e.handleChange}}):e._e(),e.showFormItem("textarea")?t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorator,expression:"decorator"}],attrs:{placeholder:"placeholder",autocomplete:"off","auto-size":!0},on:{change:e.handleBlur,blur:e.handleBlur}}):e._e(),e.showFormItem("number")?t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorator,expression:"decorator"}],attrs:{min:e.min,max:e.max,placeholder:e.placeholder}}):e._e(),e.showFormItem("switch")?t("a-switch",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorator,expression:"decorator"}],attrs:{placeholder:e.placeholder,value:e.value},on:{change:e.handleChange}}):e._e(),e.showFormItem("datePicker")?t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorator,expression:"decorator"}],attrs:{showTime:e.showTime,format:e.format,placeholder:e.placeholder}}):e._e(),e.showFormItem("rangePicker")?t("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorator,expression:"decorator"}],attrs:{showTime:e.showTime,format:e.format,placeholder:e.placeholder}}):e._e(),e.showFormItem("monthPicker")?t("a-month-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorator,expression:"decorator"}],attrs:{showTime:e.showTime,format:e.format,placeholder:e.placeholder}}):e._e(),e.showFormItem("select")?t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorator,expression:"decorator"}],attrs:{placeholder:e.placeholder,mode:e.selectMode,labelInValue:e.selectLabelInValue,allowClear:e.allowClearSelect},on:{change:e.handleChange}},[e._t("default")],2):e._e(),e.showFormItem("autoComplete")?t("a-auto-complete",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorator,expression:"decorator"}],attrs:{placeholder:e.placeholder,optionLabelProp:"text",disabled:e.notEdit},on:{search:e.handleSearch}},[t("template",{slot:"dataSource"},[e._t("default")],2)],2):e._e()],1)],1),e.singleEdit?t("a-icon",{staticClass:"editable-cell-icon-check",attrs:{type:"check"},on:{click:function(t){return e.check(!0)}}}):e._e()],1):t("div",{class:["editable-cell-text-wrapper",e.singleEdit?"single-edit":""]},[e._v(" "+e._s(e.getText||" ")+" "),e.singleEdit?t("a-icon",{staticClass:"editable-cell-icon",attrs:{type:"edit"},on:{click:e.edit}}):e._e()],1)])},o=[],n=a("5530"),i=(a("a9e3"),{data:function(){return{form:this.$form.createForm(this),editable:this.defaultEditable}},props:{text:{type:[Number,String,Array,Object]},value:{message:{type:[Number,String,Array,Object],default:""}},formType:{validator:function(e){return-1!==["input","textarea","number","switch","datePicker","rangePicker","select","monthPicker","autoComplete"].indexOf(e)},default:"input"},decoratorOptions:{type:[Array,Object]},min:{type:Number,default:-1/0},max:{type:Number,default:1/0},placeholder:{type:String,default:"请输入"},singleEdit:{type:Boolean,default:!1},defaultEditable:{type:Boolean,default:!1},autoSave:{type:Boolean,default:!1},format:{type:String,default:"YYYY-MM-DD"},showTime:{type:[Boolean,Object],default:!1},notEdit:{type:Boolean,default:!1},selectMode:{type:String,default:void 0},selectLabelInValue:{type:Boolean,default:!1},selectDefaultValue:{type:Array},allowClearSelect:{type:Boolean,default:!1}},computed:{getText:function(){return"function"===typeof this.text?this.text():this.text},decorator:{get:function(){if(this.decoratorOptions){var e=["formName",Object(n["a"])({initialValue:this.value},this.decoratorOptions)];return e}var t=["formName",{initialValue:this.value}];return t},set:function(e){this.decorator[1].initialValue=e}}},watch:{defaultEditable:function(e){this.editable=e}},methods:{showFormItem:function(e){return this.formType===e},handleChange:function(e){this.autoSave&&("input"===this.formType||"textarea"===this.formType?this.$emit("valueChange",e.target.value):"select"===this.formType&&this.$emit("selectChange",e))},handleBlur:function(e){"textarea"===this.formType&&this.$emit("on-blur",e.target.value)},handleSearch:function(e){this.$emit("autoCompleteSearch",e)},validate:function(){var e=this,t={success:!1,value:""};return this.form.validateFields((function(a,r){a||(e.editable?t.value=r.formName:t.value=e.getText,t.success=!0)})),t},setValue:function(e){this.form.setFieldsValue({formName:e})},check:function(e){var t=this;this.form.validateFields((function(a,r){a||(e&&(t.editable=!1),t.$emit("valueChange",r.formName))}))},edit:function(){this.editable=!0,this.decorator=this.value}}}),c=i,l=(a("f2d9"),a("2877")),s=Object(l["a"])(c,r,o,!1,null,"731854c2",null);t["default"]=s.exports},f2d9:function(e,t,a){"use strict";a("be0e")}}]);