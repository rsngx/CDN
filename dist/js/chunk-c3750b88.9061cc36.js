(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c3750b88","chunk-01fc0ad8","chunk-de87f5ce"],{"0187":function(e,t,n){"use strict";n.d(t,"e",(function(){return i})),n.d(t,"i",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"l",(function(){return l})),n.d(t,"m",(function(){return u})),n.d(t,"d",(function(){return d})),n.d(t,"c",(function(){return f})),n.d(t,"j",(function(){return h})),n.d(t,"h",(function(){return p})),n.d(t,"b",(function(){return m})),n.d(t,"f",(function(){return g})),n.d(t,"g",(function(){return b})),n.d(t,"k",(function(){return y}));var r=n("b775"),a={page:"/common/page/portal.t_sys_role",roleListAll:"/role/listAll",add:"/role/add",update:"/role/update",delete:"/role/delete",assignUsers:"/role/assignUsers",getUsers:"/role/getUsers",listAll:"/user/listAll",assignMenus:"/role/assignMenus",role:"/role"},o="role_id,role_name,create_date,create_by,remark,status,security";function i(e){return Object(r["b"])({url:a.roleListAll,method:"post",params:e})}function s(e){e.fields=o;var t=[];if(e.role_name){var n={col:"role_name"};n.value="%"+e.role_name+"%",n.opt="like",t.push(n)}if(e.status){var i={col:"status"};i.value=e.status,i.opt="=",t.push(i)}return t.length>0&&(e.wheres=JSON.stringify([t])),e.orderBy="create_date desc,role_id desc",Object(r["b"])({url:a.page,method:"post",params:e})}function c(e){return Object(r["b"])({url:a.add,method:"post",params:e})}function l(e){var t={role_name:e.role_name,status:e.status,security:e.security,remark:e.remark};e.set=JSON.stringify(t);var n=[];if(e.role_id){var o={col:"role_id"};o.value=e.role_id,o.opt="=",n.push(o)}return n.length>0&&(e.wheres=JSON.stringify(n)),Object(r["b"])({url:a.update,method:"post",params:e})}function u(e){var t={status:e.status};e.set=JSON.stringify(t);var n=[];if(e.role_id){var o={col:"role_id"};o.value=e.role_id,o.opt="=",n.push(o)}return n.length>0&&(e.wheres=JSON.stringify(n)),Object(r["b"])({url:a.update,method:"post",params:e})}function d(e){var t={role_id:e.role_id};return Object(r["b"])({url:a.delete,method:"post",params:t})}function f(e){return Object(r["b"])({url:a.assignUsers,method:"post",data:e})}function h(e){return Object(r["b"])({url:a.getUsers,method:"get",params:e})}function p(e){return Object(r["b"])({url:a.listAll,method:"get",params:e})}function m(e){return Object(r["b"])({url:a.assignMenus,method:"post",params:e})}function g(e){e.fields="menu_id";var t=[];if(e.role_id){var n={col:"role_id"};n.value=e.role_id,n.opt="=",t.push(n)}return t.length>0&&(e.wheres=JSON.stringify([t])),Object(r["b"])({url:"common/query/portal.t_sys_role_menu",method:"post",params:e})}function b(e){e.fields="id";var t=[];if(e.menu_name){var n={col:"status",value:1,opt:"="};t.push(n)}return t.length>0&&(e.wheres=JSON.stringify([t])),Object(r["b"])({url:"common/query/portal.t_sys_sub_system",method:"post",params:e})}function y(e){return Object(r["b"])({url:"role/isAllowDelete",method:"post",params:e})}},"06c5":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n("a630"),n("fb6a"),n("b0c0"),n("d3b7"),n("ac1f"),n("25f0"),n("3ca3");var r=n("6b75");function a(e,t){if(e){if("string"===typeof e)return Object(r["a"])(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Object(r["a"])(e,t):void 0}}},1216:function(e,t,n){"use strict";n.d(t,"g",(function(){return o})),n.d(t,"i",(function(){return i})),n.d(t,"a",(function(){return s})),n.d(t,"j",(function(){return c})),n.d(t,"d",(function(){return l})),n.d(t,"c",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"b",(function(){return f})),n.d(t,"f",(function(){return h})),n.d(t,"h",(function(){return p}));var r=n("b775"),a={service:"/service",permissionNoPager:"/permission/no-pager",orgTree:"/org/getOrgTree",queryTree:"/org/queryOrgTree",add:"/org/add",update:"/org/update",delete:"/org/delete",subTree:"/org/getSubOrgTree"};function o(e){return Object(r["b"])({url:a.orgTree,method:"get",params:e})}function i(e){return Object(r["b"])({url:a.queryTree,method:"get",params:e})}function s(e){return Object(r["b"])({url:a.add,method:"post",params:e})}function c(e){return Object(r["b"])({url:a.update,method:"post",params:e})}function l(e){return Object(r["b"])({url:a.delete,method:"get",params:e})}function u(e){return Object(r["b"])({url:"org/assignRoles",method:"post",params:e})}function d(e){return Object(r["b"])({url:"/org/getRoles",method:"get",params:e})}function f(e){return Object(r["b"])({url:"role/assignOrgs",method:"post",params:e})}function h(e){e.fields="dept_id";var t=[];if(e.role_id){var n={col:"role_id"};n.value=e.role_id,n.opt="=",t.push(n)}return t.length>0&&(e.wheres=JSON.stringify([t])),Object(r["b"])({url:"common/query/portal.t_sys_role_dept",method:"post",params:e})}function p(e){return Object(r["b"])({url:"org/isAllowDelete",method:"post",params:e})}},2909:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n("6b75");function a(e){if(Array.isArray(e))return Object(r["a"])(e)}n("a4d3"),n("e01a"),n("d28b"),n("a630"),n("d3b7"),n("3ca3"),n("ddb0");function o(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var i=n("06c5");function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e){return a(e)||o(e)||Object(i["a"])(e)||s()}},"5a41":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("a-modal",{attrs:{title:e.title,width:800,visible:e.visible,confirmLoading:e.confirmLoading},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("s-table",{ref:"table",attrs:{size:"default",rowKey:"key",columns:e.columns,data:e.loadData,alert:e.alert,rowSelection:e.rowSelection,showPagination:"auto"}})],1)],1)},a=[],o=n("5530"),i=n("b85c"),s=(n("d81d"),n("a9e3"),n("b64b"),n("d3b7"),n("25f0"),n("2af9")),c=n("0187"),l=n("1216"),u={name:"OrgRole",components:{STable:s["l"]},props:{orgRoleKey:{type:Number},checkedKeys:{type:Array,default:function(){return[]}}},data:function(){var e=this;return{columns:[{title:"角色ID",dataIndex:"role_id"},{title:"角色名称",dataIndex:"role_name"}],recordList:[],visible:!1,title:"",dept_id:this.orgRoleKey,confirmLoading:!1,selectedRowKeys:this.checkedKeys,selectedRows:[],alert:{show:!0,clear:function(){e.$refs.table.updateSelect([],[])}},rowSelection:{selectedRowKeys:this.selectedRowKeys,selectedRows:this.selectedRows,onChange:this.onSelectChange},optionAlertShow:!1}},created:function(){var e={pageNo:1,pageSize:10};this.loadData(e)},updated:function(){this.$refs.table.updateSelect(this.selectedRowKeys,this.selectedRows)},methods:{loadData:function(e){var t=this;return this.selectedRows=[],Object(c["i"])(Object.assign(e,{status:1})).then((function(e){var n,r=Object(i["a"])(e.result.data);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.key=a.role_id;var s=t.selectedRowKeys.indexOf(a.role_id)>-1;s&&t.selectedRows.push(a)}}catch(c){r.e(c)}finally{r.f()}return t.recordList=e.result.data.map((function(e){return Object(o["a"])(Object(o["a"])({},e),{},{key:e.role_id})})),t.title="配置角色",t.visible=!0,e.result}))},add:function(e,t){this.dept_id=e.dept_id},getCheckedKeys:function(e){var t=this;return this.checkedKeys=[],Object(l["e"])(e).then((function(e){if(e.result){var n,r=JSON.parse(e.result),a=Object(i["a"])(r);try{for(a.s();!(n=a.n()).done;){var o=n.value;t.checkedKeys.push(o.role_id.toString())}}catch(s){a.e(s)}finally{a.f()}}t.selectedRowKeys=t.checkedKeys,t.rowSelection.selectedRowKeys=t.checkedKeys}))},onCheck:function(e){this.checkedKeys=e},getCheckboxProps:function(e){var t=this.selectedRowKeys.indexOf(e.role_id)>-1;return t&&this.selectedRows.push(e),{props:{defaultChecked:t}}},onSelectChange:function(e,t){this.selectedRows=t,this.selectedRowKeys=e,this.selectedRoleIds=[],this.selectedRoleIds.push(e)},handleSubmit:function(e){var t=this;e.preventDefault();var n={};return n.dept_id=this.dept_id,n.roles=this.selectedRowKeys,Object(l["c"])(Object.assign(n)).then((function(e){"ok"===e.state?(t.visible=!1,t.$emit("ok",n)):t.$error({title:"错误提示",content:e.msg})}))},handleCancel:function(){this.visible=!1}}},d=u,f=n("2877"),h=Object(f["a"])(d,r,a,!1,null,"97ae2ef2",null);t["default"]=h.exports},"6b75":function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,"a",(function(){return r}))},"785c":function(e,t,n){"use strict";n("c4cc")},b107:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:600,visible:e.visible,confirmLoading:e.confirmLoading},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"父级"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["parent_name",{initialValue:e.parent_name},{}],expression:"[\n            'parent_name',\n            {\n              initialValue: parent_name\n            },{}]"}],attrs:{disabled:""}})],1),t("a-form-item",{attrs:{label:"部门名称"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["dept_name",{}],expression:"['dept_name', {}]"}]})],1)],1)],1)],1)},a=[],o=n("5530"),i=n("1216"),s={name:"OrgForm",data:function(){return{isEdit:!1,title:"",parent_id:0,parent_name:"",labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}},visible:!1,confirmLoading:!1,mdl:{}}},beforeCreate:function(){this.form=this.$form.createForm(this)},created:function(){},methods:{add:function(e){this.form.resetFields(),this.isEdit=!1,this.title="新建部门",this.parent_id=e&&e.dept_id||0,this.parent_name=e&&e.dept_name||"顶级部门",this.visible=!0},edit:function(e){var t=this;this.isEdit=!0,this.title="编辑部门",this.mdl=Object.assign({},e),this.parent_id=e.parent_id,this.dept_id=e.dept_id,this.visible=!0,this.$nextTick((function(){t.form.setFieldsValue(Object(o["a"])({},e))}))},close:function(){this.$emit("close"),this.visible=!1},handleOk:function(){var e=this,t=this.mdl;this.form.validateFields((function(n,r){if(!n){Object.assign({},t,r);return r.parent_id=e.parent_id,e.isEdit?(r.dept_id=e.dept_id,Object(i["j"])(Object.assign(r)).then((function(t){"ok"===t.state?(e.visible=!1,e.$emit("ok",r)):e.$error({title:"错误提示",content:t.msg})}))):Object(i["a"])(Object.assign(r)).then((function(t){"ok"===t.state?(e.visible=!1,e.$emit("ok",r)):e.$error({title:"错误提示",content:t.msg})}))}}))},handleCancel:function(){this.close()}}},c=s,l=n("2877"),u=Object(l["a"])(c,r,a,!1,null,null,null);t["default"]=u.exports},b85c:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n("a4d3"),n("e01a"),n("d28b"),n("d3b7"),n("3ca3"),n("ddb0");var r=n("06c5");function a(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Object(r["a"])(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==n["return"]||n["return"]()}finally{if(c)throw i}}}}},c4cc:function(e,t,n){},ceca:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:!1}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:48}},[t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{label:"部门名称"}},[t("a-input",{attrs:{placeholder:""},model:{value:e.queryParam.dept_name,callback:function(t){e.$set(e.queryParam,"dept_name",t)},expression:"queryParam.dept_name"}})],1)],1),t("a-col",{attrs:{md:e.advanced?24:8,sm:24}},[t("span",{staticClass:"table-page-search-submitButtons",style:e.advanced&&{float:"right",overflow:"hidden"}||{}},[t("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.queryOrgTree(e.queryParam)}}},[e._v("查询")]),t("a-button",{staticStyle:{"margin-left":"8px"},on:{click:function(){return e.queryParam={}}}},[e._v("重置")]),e.$auth("sys:dept:add")&&"root"===e.account&&e.orgTree&&0===e.orgTree.length?t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:function(t){return e.$refs.createModal.add()}}},[e._v(" 添加 ")]):e._e()],1)])],1)],1)],1),t("a-spin",{attrs:{spinning:e.loading}},[e.orgTree.length?t("a-table",{ref:"table",attrs:{scroll:{x:800},columns:e.columns,dataSource:e.orgTree,defaultExpandAllRows:e.isExpand},scopedSlots:e._u([{key:"action",fn:function(n,r){return t("span",{},[[e.$auth("sys:dept:update")?t("a",{staticStyle:{color:"#52c41a"},on:{click:function(t){return e.$refs.createModal.edit(r)}}},[e._v("编辑")]):e._e(),r.has_children?e._e():t("a-divider",{attrs:{type:"vertical"}}),e.$auth("sys:dept:delete")&&!r.has_children?t("a",{staticStyle:{color:"red"},on:{click:function(t){return e.handleDelete(r)}}},[e._v("删除")]):e._e(),t("a-divider",{attrs:{type:"vertical"}})],e.$auth(["sys:dept:add","sys:dept:assignRoles"])?t("a-dropdown",[t("a",{staticClass:"ant-dropdown-link"},[e._v(" 更多 "),t("a-icon",{attrs:{type:"down"}})],1),t("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[e.$auth("sys:dept:add")?t("a-menu-item",[t("a",{on:{click:function(t){return e.$refs.createModal.add(r)}}},[e._v("增加")])]):e._e(),e.$auth("sys:dept:assignRoles")?t("a-menu-item",[t("a",{on:{click:function(t){return e.openTran(r.dept_id)}}},[e._v("配置角色")])]):e._e()],1)],1):e._e()],2)}}],null,!1,2537909238)}):t("a-empty")],1),t("org-form",{ref:"createModal",on:{ok:e.handleOk}}),t("TransferMoadl",{attrs:{title:e.transferTitle,getAll:e.getAllRole,onOk:e.assignRoles,getCheck:e.handleAssignRole},model:{value:e.showTransferMoadl,callback:function(t){e.showTransferMoadl=t},expression:"showTransferMoadl"}})],1)},a=[],o=(n("d81d"),n("d3b7"),n("25f0"),n("8bbf")),i=n.n(o),s=n("1216"),c=n("0187"),l=n("b107"),u=n("5a41"),d=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:800,visible:e.value,bodyStyle:{maxHeight:"400px",minHeight:"360px",overflow:"auto"},confirmLoading:e.confirmLoading},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.Loading}},[e.isReset?t("a-transfer",{attrs:{dataSource:e.dataSource,"show-search":"","filter-option":e.filterOption,"target-keys":e.targetKeys,selectedKeys:e.selectedKeys,render:function(e){return e.title},listStyle:{height:"300px",flex:1}},on:{selectChange:e.handleSelectChange,change:e.handleChange,search:e.handleSearch}}):e._e()],1)],1)},f=[],h=n("2909"),p=(n("99af"),{name:"TransferMoadl",props:{value:{type:Boolean,default:!1},onOk:{type:Function},getAll:{type:Function},getCheck:{type:Function},title:{type:String},reViewId:{type:String}},data:function(){return{confirmLoading:!1,Loading:!1,isReset:!1,dataSource:[],targetKeys:[],selectedKeys:[]}},watch:{value:function(e){e&&this.open()}},methods:{handleSubmit:function(){this.confirmLoading=!0,this.onOk(this.targetKeys)},handleCancel:function(){this.$emit("input",!1)},open:function(){var e=this;this.Loading=!0,this.confirmLoading=!1,this.isReset=!1,this.selectedKeys=[],this.targetKeys=[],this.getCheck().then((function(t){e.Loading=!1,e.targetKeys=t,e.$nextTick((function(){e.isReset=!0}))}))},filterOption:function(e,t){return t.title.indexOf(e)>-1},handleChange:function(e,t,n){this.targetKeys=e},handleSelectChange:function(e,t){this.selectedKeys=[].concat(Object(h["a"])(e),Object(h["a"])(t))},handleSearch:function(e,t){},onChange:function(e){this.targetKeys=e}},mounted:function(){var e=this;this.getAll().then((function(t){e.dataSource=t}))}}),m=p,g=(n("785c"),n("2877")),b=Object(g["a"])(m,d,f,!1,null,"c3fe55be",null),y=b.exports,v=[{title:"部门名称",dataIndex:"dept_name",key:"dept_name",width:"150px"},{title:"创建人",dataIndex:"create_by",width:"150px",key:"create_by"},{title:"创建日期",dataIndex:"create_date",width:"220px",key:"create_date"},{title:"操作",dataIndex:"action",width:"180px",scopedSlots:{customRender:"action"}}],_={onChange:function(e,t){},onSelect:function(e,t,n){},onSelectAll:function(e,t,n){}},O={components:{orgForm:l["default"],orgRole:u["default"],TransferMoadl:y},data:function(){return{advanced:!1,account:i.a.ls.get("user").account,loading:!1,queryParam:{},orgTree:[],isExpand:!0,orgRoleKey:0,reFresh:!1,columns:v,transferTitle:"配置角色",transferId:"",showTransferMoadl:!1,rowSelection:_}},created:function(){this.getOrgTree()},methods:{getOrgTree:function(){var e=this;this.loading=!0,Object(s["g"])().then((function(t){e.loading=!1,e.orgTree=t}))},queryOrgTree:function(e){var t=this;this.loading=!0,Object(s["i"])(e).then((function(e){t.loading=!1,t.orgTree=e}))},handleOk:function(e){this.$success({title:"信息提示",centered:!0,content:"操作成功"}),this.getOrgTree()},handleAssignOk:function(e){var t=this.$createElement;this.$success({title:"提示信息",centered:!0,content:t("div",[t("p",["角色配置成功！"])])})},handleDelete:function(e){var t=this;Object(s["h"])(e).then((function(n){n.isAllowDelete?t.$confirm({centered:!0,title:"信息提示",content:"你确定要删除部门【"+e.dept_name+"】吗？",onOk:function(){Object(s["d"])(e).then((function(e){t.$success({title:"信息提示",centered:!0,content:"操作成功"}),t.queryOrgTree({})}))},onCancel:function(){return!1}}):t.$error({centered:!0,title:"信息提示",content:n.msg})}))},handleAssignRole:function(){return Object(s["e"])({dept_id:this.transferId}).then((function(e){return"ok"===e.state?e.data.map((function(e){return e.role_id.toString()})):[]}))},getAllRole:function(){return Object(c["e"])().then((function(e){return"ok"===e.state?e.data.map((function(e){return{key:e.role_id+"",title:e.role_name,description:e.remark||""}})):[]}))},assignRoles:function(e){var t=this,n={dept_id:this.transferId,roles:e};return Object(s["c"])(n).then((function(e){"ok"===e.state&&(t.$message.success("保存成功！"),t.showTransferMoadl=!1)}))},openTran:function(e){this.transferId=e,this.showTransferMoadl=!0}}},w=O,k=Object(g["a"])(w,r,a,!1,null,null,null);t["default"]=k.exports}}]);