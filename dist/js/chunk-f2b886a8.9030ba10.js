(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f2b886a8","chunk-16a752a7"],{"0187":function(e,t,s){"use strict";s.d(t,"e",(function(){return o})),s.d(t,"i",(function(){return i})),s.d(t,"a",(function(){return l})),s.d(t,"l",(function(){return c})),s.d(t,"m",(function(){return u})),s.d(t,"d",(function(){return d})),s.d(t,"c",(function(){return h})),s.d(t,"j",(function(){return f})),s.d(t,"h",(function(){return p})),s.d(t,"b",(function(){return m})),s.d(t,"f",(function(){return b})),s.d(t,"g",(function(){return y})),s.d(t,"k",(function(){return v}));var a=s("b775"),n={page:"/common/page/portal.t_sys_role",roleListAll:"/role/listAll",add:"/role/add",update:"/role/update",delete:"/role/delete",assignUsers:"/role/assignUsers",getUsers:"/role/getUsers",listAll:"/user/listAll",assignMenus:"/role/assignMenus",role:"/role"},r="role_id,role_name,create_date,create_by,remark,status,security";function o(e){return Object(a["b"])({url:n.roleListAll,method:"post",params:e})}function i(e){e.fields=r;var t=[];if(e.role_name){var s={col:"role_name"};s.value="%"+e.role_name+"%",s.opt="like",t.push(s)}if(e.status){var o={col:"status"};o.value=e.status,o.opt="=",t.push(o)}return t.length>0&&(e.wheres=JSON.stringify([t])),e.orderBy="create_date desc,role_id desc",Object(a["b"])({url:n.page,method:"post",params:e})}function l(e){return Object(a["b"])({url:n.add,method:"post",params:e})}function c(e){var t={role_name:e.role_name,status:e.status,security:e.security,remark:e.remark};e.set=JSON.stringify(t);var s=[];if(e.role_id){var r={col:"role_id"};r.value=e.role_id,r.opt="=",s.push(r)}return s.length>0&&(e.wheres=JSON.stringify(s)),Object(a["b"])({url:n.update,method:"post",params:e})}function u(e){var t={status:e.status};e.set=JSON.stringify(t);var s=[];if(e.role_id){var r={col:"role_id"};r.value=e.role_id,r.opt="=",s.push(r)}return s.length>0&&(e.wheres=JSON.stringify(s)),Object(a["b"])({url:n.update,method:"post",params:e})}function d(e){var t={role_id:e.role_id};return Object(a["b"])({url:n.delete,method:"post",params:t})}function h(e){return Object(a["b"])({url:n.assignUsers,method:"post",data:e})}function f(e){return Object(a["b"])({url:n.getUsers,method:"get",params:e})}function p(e){return Object(a["b"])({url:n.listAll,method:"get",params:e})}function m(e){return Object(a["b"])({url:n.assignMenus,method:"post",params:e})}function b(e){e.fields="menu_id";var t=[];if(e.role_id){var s={col:"role_id"};s.value=e.role_id,s.opt="=",t.push(s)}return t.length>0&&(e.wheres=JSON.stringify([t])),Object(a["b"])({url:"common/query/portal.t_sys_role_menu",method:"post",params:e})}function y(e){e.fields="id";var t=[];if(e.menu_name){var s={col:"status",value:1,opt:"="};t.push(s)}return t.length>0&&(e.wheres=JSON.stringify([t])),Object(a["b"])({url:"common/query/portal.t_sys_sub_system",method:"post",params:e})}function v(e){return Object(a["b"])({url:"role/isAllowDelete",method:"post",params:e})}},"1f4a":function(e,t,s){},6932:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("div",[t("a-modal",{attrs:{title:e.title,width:800,visible:e.visible,confirmLoading:e.confirmLoading},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("s-table",{ref:"table",attrs:{size:"default",rowKey:"key",columns:e.columns,data:e.loadData,alert:e.alert,rowSelection:e.rowSelection,showPagination:"auto"}})],1)],1)},n=[],r=s("5530"),o=s("b85c"),i=(s("d81d"),s("a9e3"),s("b64b"),s("d3b7"),s("25f0"),s("2af9")),l=s("0187"),c=s("8930"),u={name:"UserRole",components:{STable:i["l"]},props:{userRoleKey:{type:Number},checkedKeys:{type:Array,default:function(){return[]}}},data:function(){var e=this;return{columns:[{title:"角色ID",dataIndex:"role_id"},{title:"角色名称",dataIndex:"role_name"}],recordList:[],visible:!1,title:"",user_id:this.userRoleKey,confirmLoading:!1,selectedRowKeys:this.checkedKeys,selectedRows:[],alert:{show:!0,clear:function(){e.$refs.table.updateSelect([],[])}},rowSelection:{selectedRowKeys:this.selectedRowKeys,selectedRows:this.selectedRows,onChange:this.onSelectChange},optionAlertShow:!1}},created:function(){var e={pageNo:1,pageSize:10};this.loadData(e)},updated:function(){this.$refs.table.updateSelect(this.selectedRowKeys,this.selectedRows)},methods:{loadData:function(e){var t=this;return this.selectedRows=[],Object(l["i"])(Object.assign(e,{status:1})).then((function(e){var s,a=Object(o["a"])(e.result.data);try{for(a.s();!(s=a.n()).done;){var n=s.value;n.key=n.role_id;var i=t.selectedRowKeys.indexOf(n.role_id)>-1;i&&t.selectedRows.push(n)}}catch(l){a.e(l)}finally{a.f()}return t.recordList=e.result.data.map((function(e){return Object(r["a"])(Object(r["a"])({},e),{},{key:e.role_id})})),t.title="配置用户角色",t.visible=!0,e.result}))},add:function(e,t){this.user_id=e.user_id},getCheckedKeys:function(e){var t=this;return this.checkedKeys=[],Object(c["e"])(e).then((function(e){if(e.result){var s,a=JSON.parse(e.result),n=Object(o["a"])(a);try{for(n.s();!(s=n.n()).done;){var r=s.value;t.checkedKeys.push(r.role_id.toString())}}catch(i){n.e(i)}finally{n.f()}}t.selectedRowKeys=t.checkedKeys,t.rowSelection.selectedRowKeys=t.checkedKeys}))},onCheck:function(e){this.checkedKeys=e},getCheckboxProps:function(e){var t=this.selectedRowKeys.indexOf(e.role_id)>-1;return t&&this.selectedRows.push(e),{props:{defaultChecked:t}}},onSelectChange:function(e,t){this.selectedRows=t,this.selectedRowKeys=e,this.selectedRoleIds=[],this.selectedRoleIds.push(e)},handleSubmit:function(e){var t=this;e.preventDefault();var s={};return s.user_id=this.user_id,s.roles=this.selectedRowKeys,Object(c["b"])(Object.assign(s)).then((function(e){"ok"===e.state?(t.visible=!1,t.$emit("ok",s)):t.$error({title:"错误提示",content:e.msg})}))},handleCancel:function(){this.visible=!1}}},d=u,h=s("2877"),f=Object(h["a"])(d,a,n,!1,null,"6d188dc6",null);t["default"]=f.exports},"6c56":function(e,t,s){},c70f:function(e,t,s){"use strict";s("1f4a")},d95f:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:!1}},[t("a-row",{attrs:{gutter:8}},[t("depart-drawer",{attrs:{orgTree:e.orgTree,selectedKeys:[e.dept_id]},on:{"on-select":e.handleTreeSelect}}),t("a-col",{attrs:{span:24}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"用户账号/名称"}},[t("a-input",{attrs:{placeholder:""},model:{value:e.queryParam.user_name,callback:function(t){e.$set(e.queryParam,"user_name",t)},expression:"queryParam.user_name"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"手机号码"}},[t("a-input",{attrs:{placeholder:""},model:{value:e.queryParam.mobile,callback:function(t){e.$set(e.queryParam,"mobile",t)},expression:"queryParam.mobile"}})],1)],1),t("a-col",{attrs:{md:4,sm:24}},[t("a-form-item",{attrs:{label:"是否启用"}},[t("a-select",{attrs:{placeholder:"请选择","default-value":"0"},model:{value:e.queryParam.status,callback:function(t){e.$set(e.queryParam,"status",t)},expression:"queryParam.status"}},[t("a-select-option",{attrs:{value:""}},[e._v("全部")]),t("a-select-option",{attrs:{value:"1"}},[e._v("启用")]),t("a-select-option",{attrs:{value:"0"}},[e._v("禁用")])],1)],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"所属角色"}},[t("a-select",{attrs:{placeholder:"请选择"},model:{value:e.queryParam.role_id,callback:function(t){e.$set(e.queryParam,"role_id",t)},expression:"queryParam.role_id"}},e._l(e.rolesList,(function(s){return t("a-select-option",{key:s.role_id,attrs:{value:s.role_id}},[e._v(" "+e._s(s.role_name)+" ")])})),1)],1)],1),t("a-col",{attrs:{md:4,sm:24}},[t("span",{staticClass:"controls"},[t("a-button",{attrs:{type:"primary"},on:{click:e.handleQuery}},[e._v("查询")]),t("a-button",{on:{click:function(){e.queryParam={},e.selectedNode={},e.dept_id=null}}},[e._v("重置")])],1)])],1)],1)],1),t("a-row",{attrs:{gutter:8}},[t("a-col",{attrs:{span:8}}),t("a-col",{attrs:{span:16}},[t("div",{staticClass:"controls"},[e.$auth("sys:user:add")?t("a-button",{staticStyle:{"margin-right":"10px","margin-bottom":"10px"},attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("添加")]):e._e(),e.$auth("sys:user:delete")?t("a-button",{attrs:{type:"danger"},on:{click:e.handleBatchDelete}},[e._v("删除")]):e._e(),t("a-button",{attrs:{type:"primary",loading:e.downLoading,icon:"vertical-align-bottom"},on:{click:function(t){return e.downTemp()}}},[e._v(" 模板下载 ")]),e.$auth("sys:user:assignRoles")?t("a-upload",{attrs:{name:"file",action:e.upUrl,headers:e.headers,showUploadList:!1},on:{change:e.handleChange}},[t("a-button",{attrs:{type:"primary"}},[t("a-icon",{attrs:{type:"upload"}}),e._v(" "+e._s(e.uploading)+" ")],1)],1):e._e()],1)])],1),t("s-table",{ref:"table",attrs:{scroll:{x:1300,y:"53vh"},size:"default",columns:e.columns,data:e.loadData,alert:!1,rowSelection:{columnWidth:24,selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},rowKey:function(e){return e.user_id},pagination:{size:"small"}},scopedSlots:e._u([{key:"account",fn:function(s){return t("span",{},[t("a-popover",{attrs:{content:s}},[t("span",{staticClass:"ellip100"},[e._v(e._s(s))])])],1)}},{key:"sex",fn:function(s){return t("span",{},[t("a-badge",{attrs:{status:e._f("sexTypeFilter")(s),text:e._f("sexFilter")(s)}})],1)}},{key:"status",fn:function(s){return t("span",{},[t("a-badge",{attrs:{status:e._f("statusTypeFilter")(s),text:e._f("statusFilter")(s)}})],1)}},{key:"cities",fn:function(s){return t("span",{},[t("a-popover",{attrs:{content:s}},[t("span",{staticClass:"ellip100"},[e._v(e._s(s))])])],1)}},{key:"dept_name",fn:function(s){return t("span",{},[t("a-popover",{attrs:{content:s}},[t("span",{staticClass:"ellip130"},[e._v(e._s(s))])])],1)}},{key:"action",fn:function(s,a){return t("span",{},[[e.$auth("sys:user:update")?t("a",{staticClass:"divider",on:{click:function(t){return e.handleEdit(a)}}},[e._v("编辑")]):e._e(),e.$auth("sys:user:delete")?t("a",{staticClass:"divider",staticStyle:{color:"red"},on:{click:function(t){return e.handleDelete(a)}}},[e._v("删除")]):e._e()],t("a-dropdown",[t("a",{staticClass:"ant-dropdown-link"},[e._v(" 更多 "),t("a-icon",{attrs:{type:"down"}})],1),t("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[t("a-menu-item",[t("a",{on:{click:function(t){return e.handleReset(a)}}},[e._v("密码重置")])]),t("a-menu-item",[e.$auth("sys:user:assignRoles")?t("a",{on:{click:function(t){return e.handleAssignRole(a)}}},[e._v("配置角色")]):e._e()])],1)],1)],2)}}])})],1)],1),t("user-modal",{ref:"createModal",on:{ok:e.handleSaveOk,close:e.handleSaveClose}}),e.reFresh?t("user-role",{ref:"userRoleModal",attrs:{userRoleKey:e.userRoleKey,checkedKeys:e.checkedKeys},on:{ok:e.handleAssignOk}}):e._e()],1)},n=[],r=s("b85c"),o=s("5530"),i=(s("a15b"),s("b0c0"),s("b64b"),s("d3b7"),s("159b"),s("2af9")),l=s("f3c0"),c=s("47cf"),u=s("1216"),d=s("8930"),h=s("6932"),f=s("8bbf"),p=s.n(f),m=s("9fb0"),b={1:{sex:"error",text:"男"},2:{sex:"success",text:"女"}},y={0:{status:"error",text:"禁用"},1:{status:"success",text:"启用"}},v={name:"TreeList",components:{STable:i["l"],UserRole:h["default"],UserModal:c["default"],DepartDrawer:l["default"]},computed:{headers:function(){return{"Access-Token":p.a.ls.get(m["a"])}}},data:function(){var e=this;return{uploading:"导入",upUrl:"/api/user/importUsers",downLoading:!1,switcherIcon:'{<Icon type="down" />}',queryParam:{},citiesData:[],rolesList:[],columns:[{title:"账号",dataIndex:"account",fixed:"left",width:"120px",scopedSlots:{customRender:"account"}},{title:"用户名称",dataIndex:"user_name"},{title:"性别",dataIndex:"sex",scopedSlots:{customRender:"sex"},width:"80px"},{title:"城市",dataIndex:"cities",width:"120px",scopedSlots:{customRender:"cities"}},{title:"部门",dataIndex:"dept_name",width:"150px",scopedSlots:{customRender:"dept_name"}},{title:"手机",dataIndex:"mobile",width:"150px"},{title:"Email",dataIndex:"email",width:"200px",ellipsis:!0},{title:"状态",dataIndex:"status",scopedSlots:{customRender:"status"},width:"100px"},{title:"操作",dataIndex:"action",width:"180px",fixed:"right",scopedSlots:{customRender:"action"}}],loadData:function(t){return Object(d["h"])(Object(o["a"])(Object(o["a"])({},t),{},{dept_id:e.dept_id},e.queryParam)).then((function(e){return e.result}))},orgTree:[],selectedRowKeys:[],selectedRows:[],checkedKeys:[],userRoleKey:0,reFresh:!1,selectedNode:{},dept_id:null}},filters:{sexFilter:function(e){return b[e].text},sexTypeFilter:function(e){return b[e].sex},statusFilter:function(e){return y[e].text},statusTypeFilter:function(e){return y[e].status}},created:function(){var e=this;this.getOrgTree(),this.getCities(),Object(d["g"])().then((function(t){e.rolesList=t.result}))},watch:{checkedKeys:function(){var e=this;this.reFresh=!1,this.$nextTick((function(){e.reFresh=!0}))}},methods:{handleTreeSelect:function(e){this.selectedNode=e,this.dept_id=e.dept_id,this.$refs.table.refresh(!0)},getCities:function(){var e=this;Object(d["f"])().then((function(t){e.citiesData=t}))},getOrgTree:function(){var e=this;Object(u["g"])().then((function(t){e.orgTree=t}))},syncOrgTree:function(){this.$refs.orgTree;this.$refs.table.refresh(!0)},handleAdd:function(){this.$refs.createModal.add(this.selectedNode)},handleEdit:function(e){this.$refs.createModal.edit(e)},handleBatchDelete:function(){var e=this,t=[];if(e.selectedRows){var s,a=Object(r["a"])(e.selectedRows);try{for(a.s();!(s=a.n()).done;){var n=s.value;t.push(n.user_name)}}catch(o){a.e(o)}finally{a.f()}this.$confirm({centered:!0,title:"你确定要删除用户【"+t.join()+"】吗？",content:"确定后将同时删除用户的菜单权限！",onOk:function(){var t,s=[],a=Object(r["a"])(e.selectedRows);try{for(a.s();!(t=a.n()).done;){var n=t.value;s.push(n.user_id)}}catch(o){a.e(o)}finally{a.f()}e.deleteUser({user_id:s})},onCancel:function(){return!1}})}},handleDelete:function(e){var t=this;this.$confirm({centered:!0,title:"你确定要删除【"+e.user_name+"】吗？",content:"确定后将同时删除用户的菜单权限！",onOk:function(){var s=[];s.push(e.user_id),t.deleteUser({user_id:s})},onCancel:function(){return!1}})},handleStatus:function(e,t){var s=this;return e.status=t?"1":"0",Object(d["k"])({user_id:e.user_id}).then((function(e){"ok"===e.state?(s.$success({centered:!0,title:"信息提示",content:"操作成功"}),s.$refs.table.loadData(s.localPagination,{dept_id:s.dept_id},s.queryParam)):s.$error({title:"错误提示",content:e.msg})}))},handleReset:function(e){var t=this;this.$confirm({centered:!0,title:"密码重置",content:"你确定要重置用户【"+e.user_name+"】的密码吗？重置后密码将被设置为1qaz!QAZ",onOk:function(){t.updateUserPassword(e)},onCancel:function(){return!1}})},updateUserPassword:function(e){var t=this;return Object(d["j"])(Object.assign(e)).then((function(e){"ok"===e.state?t.$success({centered:!0,title:"信息提示",content:"操作成功"}):t.$error({title:"错误提示",content:e.msg})}))},deleteUser:function(e){var t=this;return Object(d["d"])(Object.assign(e)).then((function(e){"ok"===e.state?(t.$success({centered:!0,title:"信息提示",content:"操作成功"}),t.$refs.table.loadData(t.localPagination,{dept_id:t.dept_id},t.queryParam),t.selectedRowKeys=[]):t.$error({title:"错误提示",content:e.msg})}))},handleQuery:function(){this.$refs.table.refresh(!0)},handleClick:function(e){this.queryParam={key:e.key},this.$refs.table.refresh(!0)},handleTitleClick:function(e){},titleClick:function(e){},handleSaveOk:function(e){this.$success({centered:!0,title:"信息提示",content:"操作成功"}),this.$refs.table.loadData(this.localPagination,{dept_id:this.dept_id})},handleSaveClose:function(){this.$refs.table.loadData(this.localPagination,{dept_id:this.dept_id})},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},handleAssignOk:function(e){var t=this.$createElement;this.$success({title:"提示信息",centered:!0,content:t("div",[t("p",["角色配置成功！"])])})},handleAssignRole:function(e){var t=this;this.checkedKeys=[];var s=this;return Object(d["e"])(e).then((function(a){if(a.result){var n=JSON.parse(a.result);n.forEach((function(e){s.checkedKeys.push(e.role_id)})),t.userRoleKey=e.user_id,s.$refs.userRoleModal.add(e,s.checkedKeys)}}))},downTemp:function(e){e="/api"+(e||d["c"].downTemplate),e=e+"?token="+this.headers["Access-Token"],window.open(e)},handleChange:function(e){if("uploading"===e.file.status&&(this.uploading="上传中..."),"done"===e.file.status||"error"===e.file.status){this.uploading="导入";var t=e.file.response,s=this.$createElement,a="error"===e.file.status||"ok"!==t.state?"失败":"成功",n=[];"ok"===t.state&&n.push(s("p","是否下载导入结果？")),this.$confirm({title:"导入"+a,content:s("div",{},n),onOk:function(){window.open("/"+t.data)}}),"ok"===t.state&&this.$message.success("".concat(e.file.name,"导入成功"))}}}},_=v,g=(s("dc8f"),s("2877")),w=Object(g["a"])(_,a,n,!1,null,"721cb539",null);t["default"]=w.exports},dc8f:function(e,t,s){"use strict";s("6c56")},f3c0:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{"{'position'":"'relative' }"}},[t("a-drawer",{attrs:{width:"300",placement:"right",closable:!1,visible:e.visible,"get-container":!1},on:{close:e.onClose}},[t("div",{staticClass:"box-header"},[t("div",{staticClass:"box-title"},[t("i",{staticClass:"fa icon-grid"}),e._v(" 组织机构 ")])]),e.orgTree.length?t("a-tree",{ref:"orgTree",attrs:{treeData:e.orgTree,showLine:"","auto-expand-parent":e.autoExpandParent,selectedKeys:e.selectedKeys},on:{expand:this.onExpand,select:this.onSelect}}):e._e(),t("div",{staticClass:"setting-drawer-index-handle",attrs:{slot:"handle"},on:{click:e.toggle},slot:"handle"},[t("p",[e._v("组织机构")])])],1)],1)},n=[],r={name:"DepartmentDrawer",props:["orgTree","selectedKeys"],data:function(){return{visible:!1,autoExpandParent:!1}},methods:{showDrawer:function(){this.visible=!0},onClose:function(){this.visible=!1},toggle:function(){this.visible=!this.visible},onExpand:function(e,t){this.expandedKeys=e,this.autoExpandParent=!1},onSelect:function(e,t){if(t.selectedNodes.length>0){var s=t.selectedNodes[0].data.props;this.$emit("on-select",s)}else this.$emit("on-select",{})}}},o=r,i=(s("c70f"),s("2877")),l=Object(i["a"])(o,a,n,!1,null,"440627d0",null);t["default"]=l.exports}}]);